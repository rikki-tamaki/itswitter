<link href="/css/main.css" rel="stylesheet" />
<div class="main">
  <meta neme="refresh" content="10">
  <%= form_tag(restaurants_search_path) do %>
    店名:<%= text_field_tag :name %>
    <%= submit_tag '送信' %>
  <% end %>
  <% if @error.present? %>
    <h2><%= @error %></h2>
    <% @error = "" %>
  <% end %>
  
  <center><h1>検索結果</h1></center>
  <center>
    <table class="row">
      <tr>
        <td class="col-sm-4"><h1>店名</h1></td>
        <td class="col-sm-4"><h1>混雑度</h1></td>
        <td class="col-sm-4"><h1>最新更新時</h1></td>
      </tr>

      <% @searched.each do |ranking| %>

        <!-- 更新時間を計算 -->
        <% t = (Time.zone.now - ranking.updated_at).to_i %>
        <% time = nil %>

        <% if t<60 then %>
          <% time = t.to_s + "秒前" %>
        <% end %>

        <% if t/60 != 0 then %>
          <% time = (t/60).to_s + "分前"  %>
        <% end %>

        <% if t/3600 != 0 then %>
          <% time = (t/3600).to_s + "時間" + (t/60 - (t/3600)*60).to_s + "分前" %>
        <% end %>
        <tr>
          <td><h1><%= ranking.name %></h1></td>
          <td><h1><%= ranking.seats_occ %>％</h1></td>
          <td><h1><%= time %></h1></td>
        </tr>
      <% end %>
    </table>
  </center>
  <br>
</div>
